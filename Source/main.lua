


import 'CoreLibs/graphics'
import 'CoreLibs/sprites'
import "CoreLibs/timer"
import 'CoreLibs/easing'
import 'CoreLibs/ui'
import 'CoreLibs/ui/gridview'
import 'CoreLibs/utilities/printer'
import 'helpers/gfxp'

local gfx = playdate.graphics
local gfxp = GFXP

local showLabel = true -- show pattern label
local currentView = 1 -- 1 - show patterns grid, 2 - show animation
local a, b, c, d, f, g -- animation variables
local patternView

function init()

	-- init grid
	
	local patterns = gfxp.getPatterns(true)
	patternView = playdate.ui.gridview.new(400, 240)
	patternView:setNumberOfRows(#patterns)

	function patternView:drawCell(section, row, column, selected, x, y, width, height)

		gfxp.set(patterns[row])
		gfx.fillRect(x, y, width, 240)

		if showLabel then
			gfx.setColor(gfx.kColorWhite)
			gfx.fillRoundRect(150, y+5, 100, 30, 10)
			gfx.drawTextInRect(patterns[row], x, y+11, width, height+30, nil, "", kTextAlignment.center)
		end
	end
	
	-- init animation

	local patterns1 = {
		{0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF},
		{0xFF, 0xFF, 0xFF, 0xEF, 0xF7, 0xFF, 0xFF, 0xFF},
		{0xFF, 0xFF, 0xFF, 0xE7, 0xE7, 0xFF, 0xFF, 0xFF},
		{0xFF, 0xFF, 0xC3, 0xDB, 0xDB, 0xC3, 0xFF, 0xFF},
		{0xFF, 0x81, 0xBD, 0xBD, 0xBD, 0xBD, 0x81, 0xFF},
		{0x0, 0x7E, 0x7E, 0x7E, 0x7E, 0x7E, 0x7E, 0x0},
		{0xAA, 0x7F, 0xFE, 0x7F, 0xFE, 0x7F, 0xFE, 0x55},
		{0x0, 0x7E, 0x7E, 0x7E, 0x7E, 0x7E, 0x7E, 0x0},
		{0xFF, 0x81, 0xBD, 0xBD, 0xBD, 0xBD, 0x81, 0xFF},
		{0xFF, 0xFF, 0xC3, 0xDB, 0xDB, 0xC3, 0xFF, 0xFF},
		{0xFF, 0xFF, 0xFF, 0xE7, 0xE7, 0xFF, 0xFF, 0xFF},
		{0xFF, 0xFF, 0xFF, 0xEF, 0xF7, 0xFF, 0xFF, 0xFF},
	}

	local briks = {
		{0x0, 0xBF, 0xBF, 0xBF, 0x0, 0xFB, 0xFB, 0xFB},
		{0x0, 0x7F, 0x7F, 0x7F, 0x0, 0xF7, 0xF7, 0xF7},
		{0x0, 0xFE, 0xFE, 0xFE, 0x0, 0xEF, 0xEF, 0xEF},
		{0x0, 0xFD, 0xFD, 0xFD, 0x0, 0xDF, 0xDF, 0xDF},
		{0x0, 0xFB, 0xFB, 0xFB, 0x0, 0xBF, 0xBF, 0xBF},
		{0x0, 0xF7, 0xF7, 0xF7, 0x0, 0x7F, 0x7F, 0x7F},
		{0x0, 0xEF, 0xEF, 0xEF, 0x0, 0xFE, 0xFE, 0xFE},
		{0x0, 0xDF, 0xDF, 0xDF, 0x0, 0xFD, 0xFD, 0xFD},
	}

	local briks2 = {0x0, 0xDF, 0xDF, 0xDF, 0x0, 0xFD, 0xFD, 0xFD}
	local briks3 = {0x55, 0x55, 0x0, 0xDF, 0x10, 0xD7, 0x14, 0xD5}

	local patterns3 = {
		{0x54, 0x57, 0xFC, 0x3F, 0xFC, 0x3F, 0xEA, 0x2A},
		{0xAB, 0xA8, 0x3F, 0xFC, 0x3F, 0xFC, 0x15, 0xD5}
	}

	local patterns4 = {
		{0x0, 0x0, 0x18, 0x3C, 0x3C, 0x18, 0x0, 0x0},
		{0x0, 0x0, 0x24, 0x66, 0x66, 0x24, 0x0, 0x0},
		{0x0, 0x0, 0x42, 0xC3, 0xC3, 0x42, 0x0, 0x0},
		{0x0, 0x0, 0x81, 0xC3, 0xC3, 0x81, 0x0, 0x0},
		{0x0, 0x0, 0x42, 0xC3, 0xC3, 0x42, 0x0, 0x0},
		{0x0, 0x0, 0x24, 0x66, 0x66, 0x24, 0x0, 0x0},
		{0x0, 0x0, 0x18, 0x3C, 0x3C, 0x18, 0x0, 0x0},
	}

	local patterns5 = {
		{0x0, 0x1C, 0x3E, 0x7F, 0x7F, 0x7F, 0x3E, 0x1C},
		{0x1C, 0x3E, 0x7F, 0x7F, 0x7F, 0x3E, 0x1C, 0x0},
		{0x38, 0x7C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38, 0x0},
		{0x0, 0x38, 0x7C, 0xFE, 0xFE, 0xFE, 0x7C, 0x38},
	}

	local dlines = {0x7E, 0xFC, 0xF9, 0xF3, 0xE7, 0xCF, 0x9F, 0x3F}
	local patterns6 = gfxp.getPatterns(true)
	local ticks = 5

	a = gfxp.animate:new(patterns1)
	b = gfxp.animate:new(briks2, 'down')
	c = gfxp.animate:new(patterns3,  ticks)
	d = gfxp.animate:new(patterns4,  3)
	e = gfxp.animate:new(patterns5,  3)
	f = gfxp.animate:new(patterns6,  ticks)
	g = gfxp.animate:new(dlines, 'right', 2)

end

init()


-- Buttons

function playdate.AButtonUp()
	showLabel = not showLabel
end

function playdate.BButtonUp()
	currentView = currentView == 1 and 2 or 1
end

function playdate.upButtonUp()
	patternView:selectPreviousRow(false)
end

function playdate.downButtonUp()
	patternView:selectNextRow(false)
end

-- Update

function playdate.update()

	gfx.clear()
	
	if currentView == 1 then
		patternView:drawInRect(0, 0, 400, 240)
	else
		e:draw()
		gfx.fillRect(0, 0, 200, 120)
		b:draw()
		gfx.fillRect(200, 0, 200, 120)
		g:draw()
		gfx.fillRect(0, 120, 200, 120)
		d:draw()
		gfx.fillRect(200, 120, 200, 120)
		a:draw()
		gfx.fillCircleAtPoint(200, 120, 100)
	end
	
	playdate.timer.updateTimers()
	
end

-- Tips

print('Press the A button to show/hide the pattern label.')
print('Press the B button to switch mode (patterns grid and animation)')
print('Press the Up / Down buttons to navigate.')